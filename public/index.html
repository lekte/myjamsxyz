<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Spotify Playlist Creator</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<div class="container">
  <h1>Spotify Playlist Creator</h1>
  <button id="login" onclick="login()">Connect to Spotify</button>
  <div id="user-info"></div>
</div>

<script>

function login() {
  window.location.href = '/login';
}

function getAccessToken() {
  const urlParams = new URLSearchParams(window.location.search);
  const accessToken = urlParams.get('access_token');
  if (accessToken) {
    console.log('Access Token:', accessToken);
    localStorage.setItem('access_token', accessToken);
    getUserInfo();
  } else {
    console.log('No access token in URL');
    const storedAccessToken = localStorage.getItem('access_token');
    if (storedAccessToken) {
      getUserInfo();
    }
  }
}

function getUserInfo() {
  const accessToken = localStorage.getItem('access_token');
  if (!accessToken) {
    console.log('No access token in local storage');
    return;
  }
  
  fetch('https://api.spotify.com/v1/me', {
    headers: {
      'Authorization': 'Bearer ' + accessToken,
    },
  })
  .then(response => {
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }
    return response.json();
  })
  .then(data => {
    console.log('User Info:', data);
    const userInfoDiv = document.getElementById('user-info');
    userInfoDiv.innerHTML = `
      <h2>User Info</h2>
      <p>Name: ${data.display_name}</p>
      <p>Email: ${data.email}</p>
      <img src="${data.images[0].url}" alt="Profile Picture" width="100">
    `;
  })
  .catch(error => {
    console.error('Error fetching user info:', error);
  });
}

window.onload = getAccessToken;
</script>

</body>
</html>
